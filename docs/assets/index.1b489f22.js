import{r as w,c as b,o as c,a,b as n,w as y,v as _,d as C,F as u,e as p,t as h,f as m,g,h as B,i as k,j as N}from"./vendor.8e74757d.js";const S=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}};S();function O(e,t){const r=w("router-view");return c(),b(r)}var v=(e,t)=>{const r=e.__vccOpts||e;for(const[l,i]of t)r[l]=i;return r};const x={};var U=v(x,[["render",O]]);const D={class:"line"},E=n("label",{for:"add"},"Add coin",-1),T={class:"coins"},I={class:"line"},R=["for"],J=["onClick"],L={class:"line__price"},M=["onUpdate:modelValue","id"],V={class:"line"},A={key:0,class:"history"},H={key:1},j={key:2,class:"history"},F={class:"line"},K=["onClick"];function P(e,t,r,l,i,s){return c(),a(u,null,[n("div",D,[E,y(n("input",{class:"line__price",id:"add","onUpdate:modelValue":t[0]||(t[0]=o=>e.coin=o),onKeydown:t[1]||(t[1]=C((...o)=>s.addCoin&&s.addCoin(...o),["enter"]))},null,544),[[_,e.coin]])]),n("div",T,[(c(!0),a(u,null,p(e.coins,(o,d)=>(c(),a("div",I,[n("label",{for:o.c},[g(h(o.c),1),n("span",{class:"text-xs ml-2 text-red-600 align-middle hover:text-white",onClick:f=>s.remove(d)},"x",8,J)],8,R),n("div",L,[y(n("input",{"onUpdate:modelValue":f=>o.v=f,id:o.c,type:"Number"},null,8,M),[[_,o.v]]),n("span",null,h(o.p),1)])]))),256))]),n("div",V,[n("p",{ref:"cash"},"Your cash: "+h(Math.trunc(e.cash)),513),n("p",{class:"underline italic cursor-pointer",onClick:t[2]||(t[2]=(...o)=>s.refresh&&s.refresh(...o))},"refresh")]),typeof s.errors=="object"?(c(),a("ul",A,[(c(!0),a(u,null,p(s.errors,o=>(c(),a("li",{key:o.coin},[n("p",null,h(o.coin)+": "+h(o.error),1)]))),128))])):m("",!0),typeof s.errors=="string"?(c(),a("p",H,h(s.errors),1)):m("",!0),s.errors.length==0?(c(),a("ul",j,[(c(!0),a(u,null,p(e.history,(o,d)=>(c(),a("li",F,[n("p",null,h(s.formatDate(o.date)),1),n("p",null,[g(h(Math.trunc(o.cash)||0)+" "+h(s.calcDif(d)),1),n("span",{class:"text-xs ml-2 text-red-600 align-middle hover:text-white",onClick:f=>s.clear(d)},"x",8,K)])]))),256))])):m("",!0)],64)}const q={data:()=>({coin:"",coins:[],cash:0,history:[],otherErrors:[]}),methods:{async refresh(){this.cash=0,this.otherErrors=[],await Promise.all(this.coins.map(async(e,t)=>{await fetch(`https://min-api.cryptocompare.com/data/pricemulti?fsyms=${e.c}&tsyms=RUB&api_key=b5a5b68758c1e3428691ea0f0fcac1dfe98df8c99dba00cfac673e16b887c436`).then(r=>r.json()).then(r=>{this.cash+=+r[e.c].RUB*e.v,this.coins[t].p=+r[e.c].RUB}).catch(async r=>{console.log(r),this.otherErrors.push({coin:e.c,error:r+""}),await fetch(`https://min-api.cryptocompare.com/data/pricemulti?fsyms=${e.c}&tsyms=BTC&api_key=b5a5b68758c1e3428691ea0f0fcac1dfe98df8c99dba00cfac673e16b887c436`).then(l=>l.json()).then(async l=>{let i=+l[e.c].BTC*e.v;await fetch("https://min-api.cryptocompare.com/data/pricemulti?fsyms=BTC&tsyms=RUB&api_key=b5a5b68758c1e3428691ea0f0fcac1dfe98df8c99dba00cfac673e16b887c436").then(s=>s.json()).then(s=>{this.cash+=+s.BTC.RUB*i,this.coins[t].p=+s.BTC.RUB*i})})})})),this.history.push({date:new Date,wallet:this.coins,cash:this.cash}),localStorage.setItem("dw-history",JSON.stringify(this.history))},addCoin(){this.coin.length>0?(this.$refs.cash.focus(),this.coins.push({c:this.coin.toUpperCase(),v:0}),localStorage.setItem("dw-coins",JSON.stringify(this.coins)),this.coin="",this.errors=""):this.errors="Enter coin name"},remove(e){this.coins=this.coins.filter((t,r)=>r!==e)},clear(e){this.history=this.history.filter((t,r)=>r!==e)},formatDate(e){const t=new Date(e);let r=t.getMinutes();return t.getDate()+"."+(t.getMonth()+1)+"-"+t.getHours()+":"+(r<10?"0"+r:r)},calcDif(e){if(e==0)return"";{let t=(this.history[e].cash/this.history[e-1].cash-1).toFixed(4)*100;return t>0?"+"+t+"%":t+"%"}}},watch:{coins:{handler(e){localStorage.setItem("dw-coins",JSON.stringify(e))},deep:!0},history:{handler(e){localStorage.setItem("dw-history",JSON.stringify(e))},deep:!0}},computed:{errors:{get(){return this.otherErrors.length>0&&this.otherErrors||this.coins.length==0&&"No saved coins yet.."||this.history.length==0&&"No history yet.."},set(e){this.otherErrors=e}}},mounted(){const e=JSON.parse(localStorage.getItem("dw-history"));e&&(this.history=e);const t=JSON.parse(localStorage.getItem("dw-coins"));t&&(this.coins=t)}};var W=v(q,[["render",P]]);const Y=[{path:"/",component:W}],z=B({history:k(),routes:Y});N(U).use(z).mount("#app");
