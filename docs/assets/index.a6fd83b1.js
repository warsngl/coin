import{r as _,c as b,o as n,a as l,b as i,w as v,v as C,d as A,F as u,e as p,t as h,f as k,g as m,h as w,n as B,i as x,C as E,P as D,L as N,j as S,k as U,p as I,l as O,m as R,q as L,s as T,u as V}from"./vendor.1dadcffc.js";const Q=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}};Q();function F(e,t){const r=_("router-view");return n(),b(r)}var y=(e,t)=>{const r=e.__vccOpts||e;for(const[c,a]of t)r[c]=a;return r};const P={};var J=y(P,[["render",F]]);var M="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAoElEQVRIie2UQQ6CQAxFO95BIguuZwLHhYV7PchjU12MnUIdIprwV1DgvfkDQeRINGi24p22An1FADRAv3STu0UKaQrzSR8fPhIAZ2AEbkBrzNFrl7AggzxBbQheEmT1J+f4besWBdYKC238lVsCr372PtbBDcHg1afwRa0W6HkfhkQEtfmvX8UugpQPgLuIdFXQlF5cq8FVRB41giO/lRkNAEIMkf189QAAAABJRU5ErkJggg==";const H={class:"line"},j=i("label",{for:"add"},"Add coin",-1),q={class:"ul"},z={class:"line"},K=["for"],Y=["onClick"],W={class:"line__price"},G=["onUpdate:modelValue","id"],X={class:"line"},Z={class:"mr-1"},$={key:0,class:"chart"},ee={key:1},te={key:0,class:"ul"},se={key:1},re={key:2,class:"ul"},oe=["onClick"],ae={class:"text-sm"},ie={class:"ml-auto"},ne=["onClick"];function ce(e,t,r,c,a,s){const d=_("Line");return n(),l(u,null,[i("button",{class:"share",onClick:t[0]||(t[0]=(...o)=>s.share&&s.share(...o))},"Share"),i("div",H,[j,v(i("input",{class:"line__price",id:"add","onUpdate:modelValue":t[1]||(t[1]=o=>e.coin=o),onKeydown:t[2]||(t[2]=A((...o)=>s.addCoin&&s.addCoin(...o),["enter"]))},null,544),[[C,e.coin]]),i("button",{onClick:t[3]||(t[3]=(...o)=>s.addCoin&&s.addCoin(...o))},"+")]),i("ul",q,[(n(!0),l(u,null,p(e.coins,(o,f)=>(n(),l("li",z,[i("label",{class:"flex items-center",for:o.c},[w(h(o.c),1),i("span",{class:"cursor-pointer text-xs ml-2 text-red-600 hover:text-white",onClick:g=>s.remove(f)},"x",8,Y)],8,K),i("div",W,[v(i("input",{"onUpdate:modelValue":g=>o.v=g,id:o.c,type:"Number"},null,8,G),[[C,o.v]]),i("span",null,h(o.p),1)])]))),256))]),i("div",X,[i("p",{ref:"cash"},"Your cash: "+h(Math.trunc(e.cash)),513),i("button",Z,[i("img",{src:M,onClick:t[4]||(t[4]=o=>e.isChart=!e.isChart)})]),i("p",{class:"underline italic cursor-pointer",onClick:t[5]||(t[5]=(...o)=>s.refresh&&s.refresh(...o))},"refresh")]),e.isChart?(n(),l("div",$,[k(d,{id:"my-chart-id",data:s.chartData,options:s.chartOptions},null,8,["data","options"])])):(n(),l("div",ee,[typeof s.errors=="object"?(n(),l("ul",te,[(n(!0),l(u,null,p(s.errors,o=>(n(),l("li",{key:o.coin},[i("p",null,h(o.coin)+": "+h(o.error),1)]))),128))])):m("",!0),typeof s.errors=="string"?(n(),l("p",se,h(s.errors),1)):m("",!0),e.history.length>0?(n(),l("ul",re,[(n(!0),l(u,null,p(e.history,o=>(n(),l("li",{class:B(["line w-full cursor-pointer hover:underline",s.changeInBalance(o.date).at(0)=="-"?"text-red":"text-green"]),key:o.date,onClick:f=>s.backToDate(o.date)},[i("p",ae,h(s.formatDate(o.date)),1),i("span",ie,h(Math.trunc(o.cash)||0)+" "+h(s.changeInBalance(o.date)),1),i("span",{class:"cursor-pointer text-xs ml-2 text-red-600 hover:text-white",onClick:x(f=>s.clear(o.date),["self"])},"x",8,ne)],10,oe))),128))])):m("",!0)]))],64)}E.register(D,N,S,U,I,O);const le={data:()=>({coin:"",coins:[],cash:0,history:[],otherErrors:[],isChart:!0}),methods:{async refresh(){this.cash=0,this.otherErrors=[],this.errors=[],await Promise.all(this.coins.map(async(e,t)=>{await fetch(`https://min-api.cryptocompare.com/data/pricemulti?fsyms=${e.c}&tsyms=RUB&api_key=b5a5b68758c1e3428691ea0f0fcac1dfe98df8c99dba00cfac673e16b887c436`).then(r=>r.json()).then(r=>{this.cash+=+r[e.c].RUB*e.v,this.coins[t].p=+r[e.c].RUB}).catch(async r=>{console.log(r),this.otherErrors.push({coin:e.c,error:r+""}),await fetch(`https://min-api.cryptocompare.com/data/pricemulti?fsyms=${e.c}&tsyms=BTC&api_key=b5a5b68758c1e3428691ea0f0fcac1dfe98df8c99dba00cfac673e16b887c436`).then(c=>c.json()).then(async c=>{let a=+c[e.c].BTC*e.v;await fetch("https://min-api.cryptocompare.com/data/pricemulti?fsyms=BTC&tsyms=RUB&api_key=b5a5b68758c1e3428691ea0f0fcac1dfe98df8c99dba00cfac673e16b887c436").then(s=>s.json()).then(s=>{this.cash+=+s.BTC.RUB*a,this.coins[t].p=+s.BTC.RUB*a})})})})).finally(()=>{this.history.push({date:new Date,coins:this.coins,cash:this.cash}),localStorage.setItem("dw-history",JSON.stringify(this.history))})},addCoin(){this.coin.length>0?(this.$refs.cash.focus(),this.coins.push({c:this.coin.toUpperCase(),v:0}),this.coin="",this.errors=[]):this.errors="Enter coin name"},backToDate(e){let t=this.history.find(r=>r.date==e);t?(this.coins=JSON.parse(JSON.stringify(t.coins)),this.otherErrors=""):this.otherErrors="Cannot find this date",console.log(e,t)},remove(e){this.coins=this.coins.filter((t,r)=>r!==e)},clear(e){this.history=this.history.filter(t=>t.date!==e),localStorage.setItem("dw-history",JSON.stringify(this.history))},formatDate(e){const t=new Date(e);let r=t.getMinutes();return t.getMonth()+1+"."+t.getDate()+"/"+t.getHours()+":"+(r<10?"0"+r:r)},changeInBalance(e){if(e){let t=this.history.findIndex(c=>e==c.date);if(t==0)return"";let r=((this.history[t].cash/this.history[t-1].cash-1)*100).toFixed(2);return r>0?"+"+r+"%":r+"%"}else return""},share(){let e=this.coins.map(t=>t.c+"="+t.v).join("&");console.log(e),navigator.clipboard.writeText("https://warsngl.github.io/coin/copy?"+e)}},watch:{},computed:{errors:{get(){return this.otherErrors.length>0&&this.otherErrors||this.coins.length==0&&"No saved coins yet.."||this.history.length==0&&"No history yet.."},set(e){this.otherErrors=e}},chartData(){let e=this.history.map(r=>this.formatDate(r.date)),t=[{label:"1",backgroundColor:"#000",borderColor:"#fa0",color:"#fff",data:this.history.map(r=>r.cash)}];return{labels:e,datasets:t}},chartOptions(){return{responsive:!0,scales:{x:{ticks:{color:"#fff",font:{size:8},callback(e,t,r){return this.getLabelForValue(e).split("/")[0]}}},y:{ticks:{color:"#fff",borderColor:"green",font:{size:8}}}},plugins:{legend:{labels:{usePointStyle:!0,color:"#fff"}}}}}},mounted(){const e=JSON.parse(localStorage.getItem("dw-history"));(e==null?void 0:e.length)>0&&(this.history=e,this.coins=e.at(-1).coins,this.cash=e.at(-1).cash)},components:{Line:R}};var he=y(le,[["render",ce]]);function de(e,t,r,c,a,s){return null}const ue={props:{},data:()=>({}),methods:{},computed:{query(){return this.$route.query}},watch:{},mounted(){let e=Object.keys(this.query).map(r=>({c:r.toUpperCase(),v:this.query[r],p:0})),t=[{date:new Date,coins:e,cash:0}];localStorage.setItem("dw-history",JSON.stringify(t)),this.$router.push("/")}};var fe=y(ue,[["render",de]]);const pe=[{path:"/",component:he},{path:"/copy",component:fe}],me=L({history:T(),routes:pe});V(J).use(me).mount("#app");
